{
  "Id": "233",
  "Title": "\u0022Optimizing Indexing Speed: Testing Batch Sizes in Azure Search\u0022",
  "Text": "C:\\Users\\adamh\\Downloads\\azure-search.pdfThe two primary factors influencing the optimal batch size are:The schema of your indexThe size of your dataBecause the optimal batch size is dependent on your index and your data, the bestapproach is to test different batch sizes to determine what results in the fastest indexingspeeds for your scenario.The following function demonstrates a simple approach to testing batch sizes.\r\nC#public static async Task TestBatchSizesAsync(SearchClient searchClient, int min = 100, int max = 1000, int step = 100, int numTries = 3){    DataGenerator dg = new DataGenerator();    Console.WriteLine(\u0022Batch Size \\t Size in MB \\t MB / Doc \\t Time (ms) \\t MB / Second\u0022);    for (int numDocs = min; numDocs \u003C= max; numDocs \u002B= step)    {        List\u003CTimeSpan\u003E durations = new List\u003CTimeSpan\u003E();        double sizeInMb = 0.\r\n0;        for (int x = 0; x \u003C numTries; x\u002B\u002B)        {            List\u003CHotel\u003E hotels = dg.GetHotels(numDocs, \u0022large\u0022);            DateTime startTime = DateTime.Now;            await UploadDocumentsAsync(searchClient, hotels).\r\nConfigureAwait(false);            DateTime endTime = DateTime.Now;            durations.Add(endTime - startTime);            sizeInMb = EstimateObjectSize(hotels);        }        var avgDuration = durations.Average(timeSpan =\u003E timeSpan.TotalMilliseconds);        var avgDurationInSeconds = avgDuration / 1000;        var mbPerSecond = sizeInMb / avgDurationInSeconds;        Console. WriteLine(\u0022{0} \\t\\t {1} \\t\\t {2} \\t\\t {3} \\t {4}\u0022, numDocs, Math.Round(sizeInMb, 3), Math.Round(sizeInMb / numDocs, 3), Math.Round(avgDuration, 3), Math.Round(mbPerSecond, 3));        // Pausing 2 seconds to let the search service catch its breathBecause not all documents are the same size (although they are in this sample), weestimate the size of the data we\u0027re sending to the search service.\n"
}